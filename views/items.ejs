<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <!--<![endif]-->
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Listings</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="">
  <link rel="stylesheet" href="/vendor/normalize-4.1.1.css" type="text/css" />
  <link rel="stylesheet" href="/vendor/border-box.css" type="text/css" />
  <link rel="stylesheet" href="/styles/layout.css" type="text/css" />

  <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
  <script type="text/javascript" src="/scripts/app.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"
    integrity="sha512-rmZcZsyhe0/MAjquhTgiUcb4d9knaFc7b5xAfju483gbEXTkeJRUMIPk6s3ySZMYUHEcjKbjLjyddGWMrNEvZg=="
    crossorigin="anonymous"></script>

  <!-- Extrenal CSS Library -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- Local Js Files -->
  <script type="text/javascript" src="/vendor/jquery-3.0.0.js"></script>
  <script type="text/javascript" src="/public/scripts/home.js"></script>
  <script type="text/javascript" src="/public/scripts/myFavorites.js"></script>
  <script type="text/javascript" src="/public/scripts/items.js"></script>

</head>

<body>
  <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->
  <%- include('header') %>
  <div class="d-flex align-items-center flex-column border border-secondary pb-2">
  <h3>SortBy</h3>
  <a href="?sort=price-asc">Price - Low-High</a>
  <a href="?sort=price-desc">Price - Low-High</a>
  <form class="d-flex" action="/items/priceFilter" method="POST">
    <label for="min"></label>
    <textarea name="min" placeholder="MIN price" cols="10" rows="1"></textarea>
    <label for="max"></label>
    <textarea name="max" id="" cols="10" placeholder="MAX price" rows="1"></textarea>
    <button class="btn btn-secondary p-1" type="submit">
      search
    </button>
  </form>
  <br>
  <a href="?sort=date">Date</a>
  <br>
  <a href="?sort=favorites">Favorites</a>
  </div>


  <ul class="list-group">
  <% for (const item of items) {%>

    <% if (!(item.sold || item.deleted)) {%>
        <li class="list-group-item d-flex border border-secondary">
          <div style="width: 23%;">
          <img style="width: 90%; height: 11rem; object-fit: fit;" src=<%=item.thumbnail_photo_url%>>
          <a href='/items/<%=item.id%>'>
            <h6 class= "mr-4 text-center"><%=item.title%></h6>
          </a>
          </div>
          <div class = "d-flex flex-column justify-content-around" style="width: 70%;">
          <h5 class="title"><%= item.description.substring(0, 200) %> ... </h5>

        <div class="test border border-secondary mt-5 pb-2">
          <% if (isAdmin) {%>
            <%} else if(itemsArray.includes(item.id)) {%>
              <div class="fav">
                <img style="width: 15px;" src="https://www.flaticon.com/svg/static/icons/svg/786/786432.svg" alt="">
                <form action="/items/favs/<%= item.id %>" method="POST">
                  <button style="color: blue;">
                    Favourite
                  </button>
                </form>
            </div>
              <%} else {%>
                <div class="fav">
                  <img style="width: 15px;" src="https://www.flaticon.com/svg/static/icons/svg/786/786432.svg" alt="">
                  <form action="/items/favs/<%= item.id %>" method="POST">
                    <button>
                      Favourite
                    </button>
                  </form>
              </div>
              <%}%>

              <h6 class = "mt-3"><%= moment(item.date_listed).startOf('hour').fromNow() %></h6>
              <h6 class = "mt-3">Price: $<%= item.price %></h6>
              <h6 class = "mt-3">Likes: <%= item.number_of_likes %></h6>
            </div>

      <% if (isAdmin) {%>
      <div class = "d-flex flex-column justify-content-space">
        <form action="/items/<%=item.id%>/delete", method="POST">
          <button class="btn btn-outline-danger" type="submit">
            Delete
          </button>
        </form>

        <form action="/items/<%=item.id%>/sold", method="POST">
          <button class="btn btn-outline-success" type="submit">
            Mark As Sold
          </button>
        </form>
      </div>
    </div>
    <%}%>
      <%}%>
  <%}%>

</li>
</ul>
</body>
</html>
